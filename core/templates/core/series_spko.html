{% extends "core/base.html" %}
{% load static %}

{% block title %}Scott Pilgrim: KO | The Uranium Core{% endblock %}

{% block content %}

<!-- =========================
     TRANSMISSION MODAL (VIMEO)
========================== -->
<div class="player-modal" id="playerModal" aria-hidden="true">
  <div class="player-backdrop" data-close-player></div>

  <div class="player-panel" role="dialog" aria-modal="true">
    <div class="player-top">
      <div class="player-title">
        <span class="player-tag">TRANSMISSION</span>
        <span class="player-series">SPKO</span>
        <span class="player-name" id="playerTitle">VIDEO</span>
      </div>

      <button class="player-close" type="button" data-close-player aria-label="Close transmission">✕</button>
    </div>

    <div class="player-frame">
      <iframe
        id="playerIframe"
        title="Scott Pilgrim: KO – Transmission Player"
        frameborder="0"
        allow="autoplay; fullscreen; picture-in-picture"
        allowfullscreen
      ></iframe>
    </div>
  </div>
</div>

<!-- =========================
           HERO
========================== -->
<header class="ruoh-hero">
  <div class="ruoh-hero-inner">
    <div class="ruoh-hero-left">
      <div class="ruoh-kicker">SERIES FILE</div>

      <h1 class="ruoh-title glitch" data-text="SCOTT PILGRIM: KO">
        SCOTT PILGRIM: KO
      </h1>

      <p class="ruoh-logline">
        A fast, neon-saturated archive entry. Videos, fan art, and curated references live here.
      </p>

      <div class="ruoh-badges">
        <span class="ruoh-badge">STATUS: ACTIVE</span>
        <span class="ruoh-badge">MEDIA: ANIMATION</span>
      </div>

      <div class="ruoh-cta">
        <a class="card-link js-open-player"
           href="#"
           data-title="SPKO VIDEO 01 // TRANSMISSION"
           data-vimeo-id="1149350137">
          PLAY
        </a>

        <!-- UPDATED: send to gallery page -->
        <a class="btn-secondary" href="/spko/fanart">VIEW FAN ART</a>
      </div>

      <div class="ruoh-meta">
        <div class="ruoh-meta-row"><span class="ruoh-meta-key">CASE ID</span><span class="ruoh-meta-val">SPKO-01</span></div>
        <div class="ruoh-meta-row"><span class="ruoh-meta-key">LOCATION</span><span class="ruoh-meta-val">TORONTO (?)</span></div>
        <div class="ruoh-meta-row"><span class="ruoh-meta-key">LAST UPDATE</span><span class="ruoh-meta-val">RECENT</span></div>
      </div>
    </div>

    <div class="ruoh-hero-right">
      <div class="ruoh-poster">
        <img
          src="{% static 'core/ScottPilgrimKOTitle.png' %}"
          alt="Scott Pilgrim: KO Title Card"
        />
        <div class="ruoh-poster-caption">FILE PREVIEW // SPKO</div>
      </div>
    </div>
  </div>
</header>

<main class="ruoh-body">

  <!-- =========================
            WATCH (VIDEOS)
  ========================== -->
  <section id="videos" class="ruoh-section">
    <header class="ruoh-section-head">
      <h2 class="ruoh-section-title">WATCH</h2>
      <p class="ruoh-section-subtitle">Recovered transmissions. Viewer discretion advised.</p>
    </header>

    <div class="ruoh-grid">
      <article class="ruoh-card ruoh-video">
        <a class="ruoh-thumbLink js-open-player"
           href="#"
           data-title="SPKO VIDEO 01 // TRANSMISSION"
           data-vimeo-id="1149350137">
          <img class="ruoh-thumbImg"
               src="{% static 'core/spko/Thumbnails/Part_01_thumb.png' %}"
               alt="SPKO Video 01 preview">
          <span class="ruoh-playBadge">▶ PLAY</span>
        </a>

        <div class="ruoh-card-top">
          <span class="badge">TRANSMISSION</span>
          <span class="stamp">VIDEO 01</span>
        </div>

        <h3 class="ruoh-card-title">VIDEO 01</h3>
        <p class="ruoh-card-text">Recovered upload. Playback available via Vimeo.</p>

        <div class="ruoh-card-meta">
          <span>HOST: VIMEO</span>
          <span>STATUS: LIVE</span>
        </div>

        <a class="card-link js-open-player"
           href="#"
           data-title="SPKO VIDEO 01 // TRANSMISSION"
           data-vimeo-id="1149350137">
          PLAY
        </a>
      </article>

      <article class="ruoh-card ruoh-video">
        <a class="ruoh-thumbLink js-open-player"
           href="#"
           data-title="SPKO VIDEO 02 // TRANSMISSION"
           data-vimeo-id="1149759976">
          <img class="ruoh-thumbImg"
               src="{% static 'core/spko/Thumbnails/Part_02_thumb.png' %}"
               alt="SPKO Video 02 preview">
          <span class="ruoh-playBadge">▶ PLAY</span>
        </a>

        <div class="ruoh-card-top">
          <span class="badge">TRANSMISSION</span>
          <span class="stamp">VIDEO 02</span>
        </div>

        <h3 class="ruoh-card-title">VIDEO 02</h3>
        <p class="ruoh-card-text">Recovered upload. Playback available via Vimeo.</p>

        <div class="ruoh-card-meta">
          <span>HOST: VIMEO</span>
          <span>STATUS: LIVE</span>
        </div>

        <a class="card-link js-open-player"
           href="#"
           data-title="SPKO VIDEO 02 // TRANSMISSION"
           data-vimeo-id="1149759976">
          PLAY
        </a>
      </article>
    </div>
  </section>

  <!-- =========================
        FAN ART (TEASER + LINK)
  ========================== -->
  <section id="fanart" class="ruoh-section">
    <header class="ruoh-section-head">
      <h2 class="ruoh-section-title">FAN ART</h2>
      <p class="ruoh-section-subtitle">Curated visuals from the archive feed.</p>
    </header>

    <div class="ruoh-grid">
      <article class="ruoh-card" style="grid-column: 1 / -1;">
        <div class="ruoh-card-top">
          <span class="badge">IMAGE</span>
          <span class="stamp">ARCHIVE</span>
        </div>

        <h3 class="ruoh-card-title">Open the Fan Art Gallery</h3>

        <p class="ruoh-card-text">
          View the full archive. The gallery auto-updates from the folder whenever new files are added.
        </p>

        <div class="ruoh-image-wrap">
          <img
            src="{% static 'core/spko/Fanart/ScottPataParaTwitter.png' %}"
            alt="Scott Pilgrim: KO fan art preview"
          />
        </div>

        <div class="ruoh-card-foot" style="display:flex; justify-content:space-between; gap:12px; align-items:center;">
          <span class="ruoh-foot-note">Preview from archive</span>
          <a class="card-link" href="/spko/fanart">OPEN GALLERY</a>
        </div>
      </article>
    </div>
  </section>

</main>

{% endblock %}

{% block scripts %}
<script>
(function () {
  const modal = document.getElementById("playerModal");
  const iframe = document.getElementById("playerIframe");
  const titleEl = document.getElementById("playerTitle");

  if (!modal || !iframe || !titleEl) return;

  function openPlayer(btn) {
    const title = btn.dataset.title || "TRANSMISSION";
    const vimeoId = btn.dataset.vimeoId;
    const ytId = btn.dataset.ytId;

    titleEl.textContent = title;

    if (vimeoId) {
      iframe.src = `https://player.vimeo.com/video/${vimeoId}?autoplay=1&muted=0&title=0&byline=0&portrait=0`;
    } else if (ytId) {
      iframe.src = `https://www.youtube.com/embed/${ytId}?autoplay=1&rel=0`;
    } else {
      return;
    }

    modal.classList.add("is-open");
    modal.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
  }

  function closePlayer() {
    iframe.src = "";
    modal.classList.remove("is-open");
    modal.setAttribute("aria-hidden", "true");
    document.body.style.overflow = "";
  }

  document.addEventListener("click", (e) => {
    const openBtn = e.target.closest(".js-open-player");
    if (openBtn) {
      e.preventDefault();
      openPlayer(openBtn);
      return;
    }
    if (e.target.closest("[data-close-player]")) closePlayer();
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && modal.classList.contains("is-open")) {
      closePlayer();
    }
  });
})();
</script>
{% endblock %}
